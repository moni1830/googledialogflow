const axios = require('axios');
exports.Webhook = async (req, res) => {
 const tag = req.body.fulfillmentInfo.tag;
 const sessionParams = req.body.sessionInfo.parameters;
 if (tag === 'get-weather') {
   const city = sessionParams['geo-city']; // Take dynamic city from user input
   if (!city) {
     return res.json({
       fulfillment_response: {
         messages: [
           {
             text: {
               text: ["âš ï¸ Please provide a city name to get the weather."]
             }
           }
         ]
       }
     });
   }
   try {
     const url = `https://wttr.in/${encodeURIComponent(city)}?format=j1`;
     const response = await axios.get(url);
     const weather = response.data.current_condition[0];
     const message = `ğŸŒ¤ï¸ Weather in ${city}:\n` +
                     `ğŸŒ¡ï¸ Temperature: ${weather.temp_C}Â°C\n` +
                     `â˜ï¸ Condition: ${weather.weatherDesc[0].value}\n` +
                     `ğŸ’§ Humidity: ${weather.humidity}%\n` +
                     `ğŸ’¨ Wind: ${weather.windspeedKmph} km/h`;
     res.json({
       fulfillment_response: {
         messages: [
           {
             text: {
               text: [message]
             }
           }
         ],
       },
       sessionInfo: {
         parameters: {
           'weather-result': message // Optional: set result as a session param
         }
       }
     });
   } catch (error) {
     res.json({
       fulfillment_response: {
         messages: [
           {
             text: {
               text: ["âŒ Could not fetch weather at the moment. Try again later."]
             }
           }
         ]
       }
     });
   }
 } else {
   res.json({
     fulfillment_response: {
       messages: [
         {
           text: {
             text: ["âš ï¸ Unrecognized tag."]
           }
         }
       ]
     }
   });
 }
};
